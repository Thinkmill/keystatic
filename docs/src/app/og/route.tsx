import { ImageResponse, NextRequest } from 'next/server';

export const runtime = 'edge';

export async function GET(req: NextRequest) {
  const { searchParams } = req.nextUrl;
  const postTitle = searchParams.get('title') || '';

  const titleLength = postTitle.length;

  // This would perhaps be better handled with ch units (or other) in CSS,
  // but I am not actually sure it would.
  let titleSize = '80px';
  if (titleLength > 12) titleSize = '60px';
  if (titleLength > 20) titleSize = '44px';
  // const font = fetch(
  //   new URL('../../public/fonts/kaisei-tokumin-bold.ttf', import.meta.url)
  // ).then(res => res.arrayBuffer());
  // const fontData = await font;

  return new ImageResponse(
    (
      <div
        style={{
          height: '100%',
          width: '100%',
          display: 'flex',
          position: 'relative',
        }}
      >
        <div
          style={{
            height: '100%',
            width: '40%',
            backgroundColor: '#F7DE5B',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
          }}
        >
          <svg
            width={274}
            height={40}
            viewBox="0 0 274 40"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M22.4971 5.53083C22.6348 4.44912 22.045 3.40558 21.0472 2.96572C20.0494 2.52586 18.8811 2.79436 18.1755 3.62572L3.12197 21.3615C2.50086 22.0933 2.36137 23.1192 2.76456 23.9902C3.16775 24.8613 4.04017 25.4188 5 25.4188H15.7514L14.5992 34.4683C14.4615 35.55 15.0514 36.5935 16.0492 37.0334C17.047 37.4732 18.2152 37.2047 18.9208 36.3734L33.9744 18.6376C34.5955 17.9058 34.735 16.8799 34.3318 16.0088C33.9286 15.1378 33.0562 14.5803 32.0963 14.5803H21.345L22.4971 5.53083Z"
              fill="black"
              stroke="black"
              stroke-width="4.92661"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <path
              d="M54.294 34V5.33611H60.3543V17.9745H60.7322L71.0473 5.33611H78.3112L67.6742 18.1705L78.4372 34H71.1872L63.3355 22.2153L60.3543 25.8543V34H54.294ZM81.4673 34V5.33611H100.782V10.3327H87.5276V17.1628H99.7882V22.1594H87.5276V29.0034H100.838V34H81.4673ZM103.92 5.33611H110.709L117.245 17.6806H117.525L124.061 5.33611H130.849L120.394 23.8669V34H114.376V23.8669L103.92 5.33611ZM149.709 13.5798C149.597 12.4508 149.116 11.5737 148.267 10.9485C147.418 10.3234 146.266 10.0108 144.81 10.0108C143.821 10.0108 142.986 10.1507 142.305 10.4307C141.623 10.7013 141.101 11.0792 140.737 11.5643C140.383 12.0495 140.205 12.6001 140.205 13.2159C140.187 13.7291 140.294 14.1769 140.527 14.5595C140.77 14.9421 141.101 15.2733 141.521 15.5532C141.941 15.8238 142.426 16.0617 142.976 16.267C143.527 16.463 144.115 16.6309 144.74 16.7709L147.315 17.3867C148.566 17.6666 149.713 18.0398 150.758 18.5064C151.803 18.9729 152.708 19.5468 153.473 20.2279C154.239 20.909 154.831 21.7115 155.251 22.6352C155.68 23.559 155.899 24.618 155.909 25.8123C155.899 27.5665 155.452 29.0874 154.565 30.375C153.688 31.6533 152.419 32.647 150.758 33.3562C149.107 34.056 147.115 34.4059 144.782 34.4059C142.468 34.4059 140.452 34.0513 138.736 33.3422C137.028 32.6331 135.694 31.5834 134.733 30.1931C133.781 28.7935 133.282 27.0626 133.235 25.0005H139.1C139.165 25.9616 139.44 26.764 139.925 27.4079C140.42 28.0424 141.078 28.5229 141.899 28.8495C142.729 29.1667 143.667 29.3253 144.712 29.3253C145.738 29.3253 146.629 29.176 147.385 28.8774C148.15 28.5789 148.743 28.1637 149.163 27.6318C149.583 27.1 149.793 26.4888 149.793 25.7983C149.793 25.1545 149.601 24.6133 149.219 24.1748C148.845 23.7362 148.295 23.363 147.567 23.0551C146.849 22.7472 145.967 22.4673 144.922 22.2153L141.801 21.4316C139.384 20.8437 137.476 19.9246 136.076 18.6743C134.677 17.424 133.982 15.7398 133.991 13.6218C133.982 11.8863 134.444 10.37 135.377 9.07306C136.319 7.77609 137.611 6.76371 139.253 6.03591C140.896 5.30812 142.762 4.94422 144.852 4.94422C146.979 4.94422 148.836 5.30812 150.422 6.03591C152.018 6.76371 153.259 7.77609 154.145 9.07306C155.032 10.37 155.489 11.8723 155.517 13.5798H149.709ZM158.893 10.3327V5.33611H182.435V10.3327H173.659V34H167.669V10.3327H158.893ZM187.75 34H181.256L191.151 5.33611H198.961L208.842 34H202.348L195.168 11.8863H194.944L187.75 34ZM187.344 22.7332H202.684V27.4638H187.344V22.7332ZM207.698 10.3327V5.33611H231.239V10.3327H222.463V34H216.473V10.3327H207.698ZM241.176 5.33611V34H235.116V5.33611H241.176ZM271.453 15.3713H265.323C265.211 14.5782 264.982 13.8737 264.637 13.2579C264.292 12.6327 263.849 12.1009 263.307 11.6623C262.766 11.2238 262.141 10.8879 261.432 10.6546C260.732 10.4213 259.972 10.3047 259.151 10.3047C257.667 10.3047 256.375 10.6733 255.274 11.4104C254.173 12.1382 253.319 13.2019 252.712 14.6015C252.106 15.9918 251.803 17.6806 251.803 19.6681C251.803 21.7115 252.106 23.4283 252.712 24.8186C253.328 26.2089 254.187 27.2586 255.288 27.9677C256.389 28.6768 257.662 29.0314 259.109 29.0314C259.92 29.0314 260.671 28.9241 261.362 28.7095C262.062 28.4949 262.682 28.1823 263.223 27.7718C263.765 27.3519 264.212 26.8434 264.567 26.2462C264.931 25.649 265.183 24.9679 265.323 24.2028L271.453 24.2308C271.294 25.5464 270.898 26.8154 270.263 28.0377C269.638 29.2507 268.794 30.3377 267.73 31.2988C266.676 32.2505 265.416 33.0063 263.951 33.5661C262.496 34.1166 260.849 34.3919 259.011 34.3919C256.454 34.3919 254.168 33.8134 252.153 32.6564C250.146 31.4994 248.56 29.8245 247.394 27.6318C246.237 25.4391 245.658 22.7845 245.658 19.6681C245.658 16.5423 246.246 13.883 247.422 11.6903C248.598 9.4976 250.193 7.82741 252.209 6.67973C254.224 5.52273 256.491 4.94422 259.011 4.94422C260.671 4.94422 262.211 5.17749 263.629 5.64402C265.057 6.11056 266.321 6.7917 267.422 7.68744C268.523 8.57386 269.419 9.66089 270.109 10.9485C270.809 12.2362 271.257 13.7104 271.453 15.3713Z"
              fill="black"
            />
          </svg>
        </div>
        <div
          style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            height: '100%',
            width: '60%',
            backgroundColor: 'white',
            position: 'relative',
          }}
        >
          <svg
            style={{ position: 'absolute', left: -1, top: 0, height: '100%' }}
            width="30"
            height="630"
            viewBox="0 0 30 630"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M29.3628 55.4769C28.8299 42.8549 27.7642 28.3857 26.9649 23.1521C26.1656 18.2264 25.2331 8.06717 24.9667 0.986489C24.7003 -6.09419 23.7678 -14.0984 22.8353 -16.5613C20.7039 -22.4105 17.2403 -57.8139 18.7056 -59.9689C19.2385 -60.5846 19.1053 -69.2046 18.5724 -79.056C17.1071 -104.3 16.5742 -207.74 17.7732 -226.211C18.4392 -234.523 18.8389 -258.228 18.8389 -278.546C18.8389 -298.865 19.3717 -320.415 20.0378 -326.88C24.5671 -365.054 25.2332 -414.927 21.5032 -432.166C20.0378 -439.247 18.5724 -449.714 18.0396 -455.871C17.5067 -465.107 16.5742 -467.57 13.6435 -468.801C11.3789 -469.725 8.84783 -468.186 6.58319 -464.491C4.45176 -461.105 -0.477169 -457.718 -5.13966 -456.795C-9.80216 -455.563 -13.3989 -453.101 -13.7986 -450.638C-14.1982 -448.175 -17.5286 -446.636 -23.5232 -446.328C-48.7007 -445.096 -55.4946 -443.865 -58.4253 -440.479C-60.4235 -438.016 -63.6207 -437.092 -67.4839 -438.631C-71.4803 -439.863 -74.0114 -439.247 -75.4767 -436.784C-77.7414 -432.166 -84.8017 -432.474 -87.1996 -437.092C-88.1321 -438.631 -89.1978 -439.247 -89.5974 -438.324C-91.3292 -434.321 -96.791 -440.171 -98.5228 -448.175C-101.32 -459.566 -109.979 -468.493 -116.24 -466.031C-120.103 -464.799 -121.968 -465.415 -123.967 -469.725C-125.432 -472.803 -126.498 -473.419 -126.498 -471.572C-126.498 -466.031 -135.157 -467.262 -137.155 -472.496C-138.087 -475.266 -139.42 -476.19 -139.952 -474.958C-140.485 -473.727 -145.681 -473.419 -151.409 -474.651C-157.137 -475.882 -164.464 -477.113 -167.794 -477.729C-171.124 -478.653 -175.787 -477.113 -178.451 -474.651C-180.982 -471.88 -183.647 -470.341 -184.313 -470.648C-184.979 -470.956 -186.444 -470.341 -187.643 -469.109C-191.107 -465.723 -193.371 -464.491 -199.632 -462.952C-202.963 -462.028 -206.293 -460.181 -207.226 -458.334C-208.291 -456.179 -210.289 -456.795 -213.487 -459.873C-218.948 -465.107 -221.08 -462.028 -221.08 -449.099C-221.08 -444.481 -221.746 -440.171 -222.412 -439.555C-223.344 -438.939 -223.478 -428.164 -222.678 -406.307C-221.613 -374.597 -222.412 -343.812 -224.943 -323.186C-225.609 -317.336 -227.474 -302.559 -229.073 -290.861C-230.538 -278.854 -232.137 -263.769 -232.403 -256.997C-232.803 -250.532 -233.868 -242.219 -234.934 -238.525C-237.598 -228.674 -238.664 -218.822 -239.73 -192.347C-241.861 -139.088 -243.859 -105.532 -245.724 -92.2938C-246.79 -84.5974 -247.856 -68.5889 -247.989 -56.8904C-248.122 -38.7269 -247.589 -33.1855 -244.659 -21.487C-242.794 -13.7906 -240.662 0.0629112 -239.996 9.29858C-237.998 34.8506 -239.73 172.154 -242.394 198.63C-243.193 207.25 -243.859 233.11 -243.593 257.122C-243.46 280.827 -243.46 336.549 -243.46 380.572C-243.726 455.381 -243.859 462.154 -246.524 476.008C-249.055 489.553 -249.454 497.866 -249.854 560.36C-250.254 613.004 -249.854 635.169 -248.389 652.717C-246.657 673.035 -245.991 708.439 -246.257 775.859C-246.391 786.942 -245.192 809.415 -243.726 825.732C-242.261 842.048 -241.062 865.753 -241.062 878.375C-241.062 907.314 -237.732 948.566 -234.135 964.883C-231.337 977.197 -231.337 979.044 -232.803 1026.76C-234.934 1091.72 -232.803 1136.36 -225.742 1173.61C-219.615 1206.24 -215.885 1217.02 -209.224 1221.63C-201.764 1226.87 -184.446 1226.56 -176.586 1221.02C-171.524 1217.32 -167.794 1217.02 -160.601 1219.17C-151.809 1221.63 -143.416 1221.02 -136.222 1217.32C-134.624 1216.71 -131.826 1212.71 -130.228 1208.7C-128.496 1204.7 -125.699 1200.7 -123.834 1199.78C-119.97 1197.62 -108.114 1207.16 -93.5939 1224.1C-85.6011 1233.64 -83.2032 1235.18 -78.0079 1233.95C-74.1447 1232.72 -71.0807 1233.64 -69.4822 1236.41C-67.0843 1240.11 -41.2408 1244.11 -41.2408 1240.72C-41.2408 1239.8 -40.1751 1238.87 -38.8429 1238.57C-36.1786 1237.95 -28.7186 1234.87 -24.1894 1232.72C-22.0579 1231.79 -21.2587 1229.33 -21.2586 1222.87C-21.2586 1208.4 -19.7933 1200.7 -16.9958 1200.7C-15.6637 1200.7 -12.3333 1197.31 -9.66902 1193C-5.93902 1187.46 -4.20723 1186.23 -2.34224 1188.69C-1.01009 1190.23 0.0556063 1193.31 0.0556062 1195.47C0.0556059 1202.24 2.58668 1190.54 4.85132 1172.99C7.64882 1151.75 8.18168 1114.5 5.65061 1114.5C4.5849 1114.5 4.31846 1112.96 4.98453 1110.81C6.05025 1106.8 6.71631 1068.32 7.24917 986.74C7.5156 943.641 9.11418 918.089 12.0449 905.159C12.711 902.08 13.5102 893.768 13.9099 886.379C14.1763 878.991 15.7749 864.522 17.2402 854.67C18.8388 844.511 19.7713 833.736 19.2385 830.658C18.8388 827.579 19.1053 825.116 19.7713 825.116C21.5031 825.116 21.5031 803.258 19.9045 798.333C18.972 796.178 19.1053 794.023 19.9045 792.791C20.837 791.56 20.5706 788.173 18.9721 782.632C15.3753 770.01 13.3771 713.672 15.7749 695.817C16.8406 688.12 18.1728 680.732 18.7056 678.885C19.2385 677.345 20.0377 665.031 20.5706 652.101C21.1035 638.863 22.3024 622.855 23.2349 616.698C24.1674 610.233 24.7002 599.458 24.3006 592.377C24.0342 583.757 24.4338 578.216 25.8992 575.137C27.4977 571.135 27.6309 566.825 26.6984 550.817C26.0324 540.042 25.0999 504.023 24.7002 471.082C24.1674 438.142 23.6345 403.662 23.3681 394.426C23.1017 385.498 23.5013 374.415 24.0342 369.798C26.1656 355.02 26.8317 328.545 27.3645 237.112C27.7642 156.454 28.297 128.439 29.8956 89.3411C30.162 83.4918 29.8956 68.099 29.3628 55.4769Z"
              fill="#F7DE5B"
            />
          </svg>

          <h1
            style={{
              textAlign: 'center',
              padding: 90,
              fontSize: titleSize,
              fontWeight: 800,
              fontFamily:
                'ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"',
            }}
          >
            {postTitle}
          </h1>
        </div>
        <svg
          style={{ position: 'absolute', right: 100 }}
          width={171}
          height={154}
          viewBox="0 0 171 154"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M49.2997 152.604C53.8857 151.577 54.8968 150.601 54.136 147.845C53.3911 144.796 52.113 143.504 45.1182 138.365C41.7735 135.925 39.0699 133.657 39.1441 133.38C39.3508 132.842 48.7295 130.25 75.6359 123.332C118.771 112.273 132.891 106.44 149.09 92.8537C159.531 84.195 166.531 75.3262 169.09 67.642C171.071 61.8806 171.28 57.6033 169.994 51.6787C168.735 46.1176 163.869 37.9281 158.988 33.2959L155.705 30.1605L157.278 27.5545C165.085 14.2721 164.232 -6.79218 155.313 -22.0039C150.375 -30.3908 144.602 -34.7276 139.667 -33.7944C138.469 -33.5217 137.344 -33.0516 137.05 -32.6554C136.756 -32.2592 137.722 -29.5667 139.283 -26.2991C150.054 -4.4769 153.112 6.49323 150.424 13.7273C149.154 17.0674 145.837 21.521 142.908 23.823C141.4 25.0217 140.889 25.0629 138.208 24.3444C130.514 22.2827 117.967 22.0077 108.593 23.6511C102.942 24.6893 100.677 25.4478 96.1427 27.9132C91.6966 30.2835 90.2032 31.4268 88.749 33.5896C82.4182 42.9937 88.9472 57.5651 100.292 59.0615C104.024 59.5868 109.997 58.5158 117.244 56.1837C125.266 53.525 132.402 49.9759 140.188 44.7014C143.773 42.2786 146.919 40.3315 147.211 40.4096C148.202 40.6751 153.572 46.9816 154.989 49.6172C157.623 54.4781 157.961 57.1806 156.536 62.4975C155.423 66.6513 154.893 67.6965 151.87 71.5167C144.827 80.3144 138.108 85.3404 123.792 92.3675C111.656 98.2571 103.866 101.215 89.155 105.287C67.622 111.271 19.4962 122.536 17.5726 122.02C16.7565 121.802 19.3395 118.457 25.9384 111.084C31.5845 104.702 33.3312 102.38 34.2618 99.8391C35.4723 96.7205 35.4289 96.6495 33.9176 95.2948C33.0602 94.5308 31.8234 93.7839 31.1822 93.6121C29.4335 93.1435 25.0022 95.4584 20.2868 99.3C11.4273 106.483 4.85162 115.169 2.02678 123.613C-1.03444 132.706 -0.33816 133.605 16.6275 140.703C29.3697 146.076 42.4755 151.725 44.6449 152.722C45.533 153.138 47.2256 153.116 49.2997 152.604ZM99.7709 45.1502C97.6248 42.2008 98.4675 39.7553 102.518 37.6946C107.827 34.9025 116.996 33.5602 124.594 34.3495C128.108 34.7569 128.458 34.8506 129.109 36.1528C129.788 37.5814 129.642 37.661 123.925 40.3437C106.073 48.6789 102.845 49.2982 99.7709 45.1502Z"
            fill="black"
          />
        </svg>
        <svg
          style={{ position: 'absolute', bottom: 0, left: '35%' }}
          width={122}
          height={118}
          viewBox="0 0 122 118"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M102.623 1.45876C86.8862 0.82513 58.6695 0.490324 57.3069 0.901524C56.4863 1.15939 54.9146 2.35063 53.8402 3.55569C51.8829 5.71852 51.8232 5.94139 52.2219 7.95919C53.2057 12.7016 58.1547 14.5651 71.2882 15.0984C76.1145 15.3167 80.2084 15.697 80.3824 15.9825C80.7888 16.5692 79.5976 17.7429 69.5891 26.3477C43.1633 49.2452 25.3026 70.7948 13.7236 93.9083C8.53365 104.163 6.67907 108.98 4.1125 118.325C0.23215 132.573 -0.330829 144.724 2.34376 156.011C4.93264 166.916 5.38129 167.813 9.35913 170.73C11.2971 172.145 13.0026 173.259 13.0909 173.163C13.1792 173.067 13.1524 169.895 13.0412 166.103C11.9641 135.299 17.1907 115.559 33.364 89.5564C41.4214 76.5471 55.0119 60.1833 69.0706 46.5128C78.1144 37.7689 98.0217 21.9033 101.011 21.0321C101.348 20.9432 101.294 22.78 100.871 25.2942C99.5264 33.1154 97.8234 45.0803 97.6152 48.4284C97.0754 56.2859 97.9675 59.0331 102.234 62.744L104.389 64.5159L105.084 63.0898C106.311 60.8506 111.441 45.4445 116.562 28.9016C120.88 14.8903 121.298 13.3302 121.08 10.4053C120.544 3.99139 116.561 2.02839 102.623 1.45876Z"
            fill="black"
          />
        </svg>
      </div>
    ),
    {
      width: 1920,
      height: 1080,
      fonts: [
        // {
        //   name: 'Kaisei Tokumin',
        //   data: fontData,
        //   style: 'normal',
        // },
      ],
    }
  );
}
